/**
 * FetchDataForms.js
 *
 * Instantly turn html form elements into asynchronous fetch forms by adding an attribute.
 * 
 * @author Nick Adams
 * @see {@link https://github.com/nickolasjadams/fetch-data-forms|Repository}
 * @license MIT
 * @version 1.0.0
*/function _array_like_to_array(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _array_with_holes(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var c=e[o](i),s=c.value}catch(e){r(e);return}c.done?t(s):Promise.resolve(s).then(n,a)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){asyncGeneratorStep(o,n,a,i,c,"next",e)}function c(e){asyncGeneratorStep(o,n,a,i,c,"throw",e)}i(void 0)})}}function _class_call_check(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _create_class(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _iterable_to_array_limit(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw n}}return o}}function _non_iterable_rest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_define_property(e,t,r[t])})}return e}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(e){if("string"==typeof e)return _array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _array_like_to_array(e,t)}}function _ts_generator(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var FetchDataForms=function(){"use strict";function e(t){_class_call_check(this,e),this.selector="form[data-fetch]",this.submitDisabledDuration=1500,this.recaptcha={version:"v3"},this.onDone="",this.onFail="",this.onAlways="",this.onBeforeSend="",t&&(t.selector&&(this.selector=t.selector),t.submitDisabledDuration&&(this.submitDisabledDuration=t.submitDisabledDuration),t.recaptcha&&(this.recaptcha=_object_spread({},this.recaptcha,t.recaptcha),parseInt(this.recaptcha.version)?this.recaptcha.version="v"+this.recaptcha.version:this.recaptcha.version=this.recaptcha.version.toLowerCase(),"v3"!==this.recaptcha.version&&console.warn("Only reCAPTCHA v3 is supported at this time."),this.recaptcha.siteKey||console.warn("reCAPTCHA siteKey must be set."))),this.forms=document.querySelectorAll(this.selector),this.addFormEventListeners()}return _create_class(e,[{key:"addFormEventListeners",value:function(){var e=this;this.forms.forEach(function(t){t.addEventListener("submit",function(t){var r,n,a,o;t.preventDefault(),r=(o=_sliced_to_array(e.prepFormData(this,t),3))[0],n=o[1],a=o[2],""===r.dataset.fetchRecaptcha?void 0===window.grecaptcha?console.warn("reCAPTCHA objects couldn't be found. Have the scripts been loaded?"):window.grecaptcha.ready(function(){window.grecaptcha.execute(e.recaptcha.siteKey,{action:"submit"}).then(function(t){n.recaptcha_token=t,e.sendXhrRequest(r,n,a)})}):e.sendXhrRequest(r,n,a)},!1)})}},{key:"prepFormData",value:function(e,t){this.onDone=window[e.getAttribute("data-fetch-done")],this.onFail=window[e.getAttribute("data-fetch-fail")],this.onAlways=window[e.getAttribute("data-fetch-always")],this.onBeforeSend=window[e.getAttribute("data-fetch-before-send")];var r=t.submitter,n=new FormData(e,r);r&&(r.disabled="disabled");var a={},o=!0,i=!1,c=void 0;try{for(var s,l=n[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=_sliced_to_array(s.value,2),f=u[0];u[1];var h=document.querySelectorAll("[name='"+f+"']");if(h.length>1){var y="INPUT"===h[0].tagName&&"submit"===h[0].type||"BUTTON"===h[0].tagName&&"button"!==h[0].type,d="INPUT"===h[0].tagName&&"radio"===h[0].type;y?a[f]=n.get(f):d?a[f]=n.get(f):a[f]=n.getAll(f)}else{var p="SELECT"===h[0].tagName&&h[0].attributes.multiple,_="INPUT"===h[0].tagName&&"file"===h[0].type&&h[0].attributes.multiple;p||_?a[f]=n.getAll(f):a[f]=n.get(f)}}}catch(e){i=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw c}}var b=new FormData;return Object.entries(a).forEach(function(e){var t=_sliced_to_array(e,2),r=t[0],n=t[1];Array.isArray(n)?n.forEach(function(e){b.append(r,e)}):b.append(r,n)}),[e,b,r]}},{key:"sendXhrRequest",value:function(e,t,r){var n,a=this,o={method:e.method};if("GET"===e.method.toUpperCase()){var i=new URLSearchParams,c=!0,s=!1,l=void 0;try{for(var u,f=t.entries()[Symbol.iterator]();!(c=(u=f.next()).done);c=!0){var h=u.value;i.append(h[0],h[1])}}catch(e){s=!0,l=e}finally{try{c||null==f.return||f.return()}finally{if(s)throw l}}e.action+=(e.action.includes("?")?"&":"?")+i.toString()}else o.body=t;r&&(setTimeout(function(){r.removeAttribute("disabled")},a.submitDisabledDuration),"function"==typeof a.onBeforeSend&&a.onBeforeSend()),fetch(e.action,o).then((n=_async_to_generator(function(t){var r,n,o,i,c,s;return _ts_generator(this,function(l){switch(l.label){case 0:if(!t.ok)return[3,2];return[4,t.json()];case 1:return r=l.sent(),e.reset(),document.querySelectorAll("[data-fetch-errors]").forEach(function(e){e.innerHTML=""}),"function"==typeof a.onDone&&a.onDone(r),e.id&&(o=e.id.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase(),e.dispatchEvent(new CustomEvent(o+"-submit",{detail:r}))),i=r.errors||(null===(n=r.responseJSON)||void 0===n?void 0:n.errors),e.querySelectorAll("[data-fetch-errors]").forEach(function(e){e.innerHTML=""}),i&&Object.entries(i).forEach(function(t){var r=_sliced_to_array(t,2),n=r[0],a=r[1].messages,o=e.querySelector('[data-fetch-errors="'.concat(n,'"]'));o&&a.forEach(function(e){o.insertAdjacentHTML("afterbegin","<div>".concat(e,"</div>"))})}),"function"==typeof a.onFail&&a.onFail(r),[3,4];case 2:return[4,t.json()];case 3:s=(r=l.sent()).errors||(null===(c=r.responseJSON)||void 0===c?void 0:c.errors),e.querySelectorAll("[data-fetch-errors]").forEach(function(e){e.innerHTML=""}),s&&Object.entries(s).forEach(function(t){var r=_sliced_to_array(t,2),n=r[0],a=r[1].messages,o=e.querySelector('[data-fetch-errors="'.concat(n,'"]'));o&&a.forEach(function(e){o.insertAdjacentHTML("afterbegin","<div>".concat(e,"</div>"))})}),"function"==typeof a.onFail&&a.onFail(r),l.label=4;case 4:return[2,r]}})}),function(e){return n.apply(this,arguments)})).then(function(e){"function"==typeof a.onAlways&&a.onAlways(e)}).catch(function(e){"function"==typeof a.onFail&&a.onFail(e)})}},{key:"printFormData",value:function(e){var t=!0,r=!1,n=void 0;try{for(var a,o=e.entries()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;"object"===_type_of(i[1])?(console.log(i[0]),console.log(i[1]),console.log(JSON.stringify(i[1],null,4))):console.log(i[0]+", "+i[1])}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}}]),e}();